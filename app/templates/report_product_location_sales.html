{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
    <h2>Product Location Sales Report</h2>
    <form method="POST" class="mb-4">
        {{ form.hidden_tag() }}
        <div class="form-group">{{ form.start_date.label }} {{ form.start_date(class="form-control") }}</div>
        <div class="form-group">{{ form.end_date.label }} {{ form.end_date(class="form-control") }}</div>
        <button type="submit" class="btn btn-primary">Generate Report</button>
    </form>
    {% if report %}
    <div class="table-responsive">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Product</th>
                <th>Last Sale Date</th>
                <th>Locations</th>
            </tr>
        </thead>
        <tbody>
            {% for row in report %}
            <tr>
                <td>{{ row.name }}</td>
                <td>{{ row.last_sale.strftime("%Y-%m-%d") if row.last_sale else "No sales" }}</td>
                <td>
                    {% if row.locations %}
                        {% for loc in row.locations %}
                            {{ loc.name }} ({{ loc.quantity }}){% if not loop.last %}<br>{% endif %}
                        {% endfor %}
                    {% else %}
                        No location sales
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% endif %}
</div>
{% endblock %}
