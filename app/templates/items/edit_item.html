{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Edit Item</h2>
    <form method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.name.label(class="form-label") }}
            {{ form.name(class="form-control", value=item.name) }}
        </div>
        <div class="form-group">
            {{ form.base_unit.label(class="form-label") }}
            {{ form.base_unit(class="form-control", value=item.base_unit) }}
        </div>
        <div class="form-group">
            {{ form.gl_code.label(class="form-label") }}
            {{ form.gl_code(class="form-control") }}
            {{ form.gl_code_id.label(class="form-label") }}
            {{ form.gl_code_id(class="form-control") }}
        </div>
        <div class="form-group">
            <label class="form-label">Cost</label>
            <input type="text" class="form-control" value="{{ item.cost }}" readonly>
        </div>
        <h4>Units</h4>
        <div id="units-container">
        {% for unit in form.units %}
        <div class="form-row mb-2">
            <div class="col">{{ unit.form.name(class="form-control") }}</div>
            <div class="col">{{ unit.form.factor(class="form-control") }}</div>
            <div class="col-auto">{{ unit.form.receiving_default() }} {{ unit.form.receiving_default.label }}</div>
            <div class="col-auto">{{ unit.form.transfer_default() }} {{ unit.form.transfer_default.label }}</div>
            <button type="button" class="btn btn-danger btn-sm remove-unit ml-2">Delete</button>
        </div>
        {% endfor %}
        </div>
        <button type="button" class="btn btn-secondary" id="add-unit">Add Unit</button>
        {{ form.submit(class="btn btn-success") }}
    </form>
</div>
<script>
    let unitIndex = {{ form.units|length }};
    document.getElementById('add-unit').addEventListener('click', function() {
        const container = document.getElementById('units-container');
        const row = document.createElement('div');
        row.classList.add('form-row', 'mb-2');
        row.innerHTML = `
            <div class="col"><input type="text" name="units-${unitIndex}-name" class="form-control" placeholder="Name"></div>
            <div class="col"><input type="number" step="any" name="units-${unitIndex}-factor" class="form-control" placeholder="Factor"></div>
            <div class="col-auto"><input type="checkbox" name="units-${unitIndex}-receiving_default"> Receiving Default</div>
            <div class="col-auto"><input type="checkbox" name="units-${unitIndex}-transfer_default"> Transfer Default</div>
            <button type="button" class="btn btn-danger btn-sm remove-unit ml-2">Delete</button>`;
        container.appendChild(row);
        unitIndex++;
    });
    document.getElementById('units-container').addEventListener('click', function(e){
        if(e.target && e.target.classList.contains('remove-unit')){
            e.target.closest('.form-row').remove();
        }
    });
</script>
{% endblock %}
