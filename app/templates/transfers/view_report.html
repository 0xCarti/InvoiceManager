{% extends 'base.html' %}
{% from 'macros/column_visibility.html' import column_visibility_dropdown %}

{% block content %}
<div class="container">
    <h2>Completed Transfer Report</h2>
    <div class="d-flex justify-content-end mb-3">
        {{ column_visibility_dropdown(
            table_id='transfer-report-table',
            storage_key='transferReportTableColumnVisibility',
            align='end',
            columns=[
                {'id': 'toggle-transfer-report-from', 'target': 'col-transfer-report-from', 'label': 'From Location', 'checked': True},
                {'id': 'toggle-transfer-report-to', 'target': 'col-transfer-report-to', 'label': 'To Location', 'checked': True},
                {'id': 'toggle-transfer-report-item', 'target': 'col-transfer-report-item', 'label': 'Item', 'checked': True},
                {'id': 'toggle-transfer-report-qty', 'target': 'col-transfer-report-quantity', 'label': 'Completed Quantity', 'checked': True},
            ]
        ) }}
    </div>
    <p>Report Period: {{ session.report_start_datetime }} to {{ session.report_end_datetime }}</p>
    <p class="text-muted">Totals reflect completed transfer quantities, including partially completed transfers.</p>
    <p>
        From Locations:
        {% if from_locations %}
            {{ from_locations | join(', ') }}
        {% else %}
            All locations
        {% endif %}
    </p>
    <p>
        To Locations:
        {% if to_locations %}
            {{ to_locations | join(', ') }}
        {% else %}
            All locations
        {% endif %}
    </p>
    <div class="table-responsive">
    <table class="table" id="transfer-report-table">
        <thead>
            <tr>
                <th scope="col" class="col-transfer-report-from">From Location</th>
                <th scope="col" class="col-transfer-report-to">To Location</th>
                <th scope="col" class="col-transfer-report-item">Item</th>
                <th scope="col" class="col-transfer-report-quantity">Completed Quantity</th>
            </tr>
        </thead>
        <tbody>
            {% for transfer in session.aggregated_transfers %}
            <tr>
                <td class="col-transfer-report-from">{{ transfer.from_location_name }}</td>
                <td class="col-transfer-report-to">{{ transfer.to_location_name }}</td>
                <td class="col-transfer-report-item">{{ transfer.item_name }}</td>
                <td class="col-transfer-report-quantity">{{ transfer.total_quantity }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endblock %}
